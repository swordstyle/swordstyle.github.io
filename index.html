<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark Mode Map</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a1a1a;
            color: #ffffff;
            overflow: hidden;
        }

        #map {
            height: 100vh;
            width: 100vw;
            background-color: #2d3748;
        }

        .map-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid #4a5568;
            border-radius: 12px;
            padding: 15px;
            min-width: 200px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        .control-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #e2e8f0;
        }

        .style-selector {
            width: 100%;
            padding: 8px 12px;
            background-color: #2d3748;
            color: #ffffff;
            border: 1px solid #4a5568;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
        }

        .style-selector:focus {
            outline: none;
            border-color: #63b3ed;
        }

        .coordinates {
            font-size: 12px;
            color: #a0aec0;
            font-family: 'Courier New', monospace;
        }

        /* Dark mode popup styles */
        .leaflet-popup-content-wrapper {
            background: #2d3748 !important;
            color: #ffffff !important;
            border-radius: 8px !important;
            border: 1px solid #4a5568 !important;
        }

        .leaflet-popup-content {
            color: #ffffff !important;
        }

        .leaflet-popup-tip {
            background: #2d3748 !important;
            border: 1px solid #4a5568 !important;
        }

        /* Dark mode zoom control */
        .leaflet-control-zoom a {
            background-color: #2d3748 !important;
            color: #ffffff !important;
            border: 1px solid #4a5568 !important;
        }

        .leaflet-control-zoom a:hover {
            background-color: #4a5568 !important;
        }

        /* Loading indicator */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 999;
            color: #e2e8f0;
            font-size: 18px;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #4a5568;
            border-radius: 50%;
            border-top-color: #63b3ed;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Video popup specific styles */
        .video-popup .leaflet-popup-content-wrapper {
            background: #1a202c !important;
            border: 1px solid #4a5568 !important;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5) !important;
        }

        .video-popup .leaflet-popup-tip {
            background: #1a202c !important;
        }

        /* Enhanced marker styles for video cameras */
        .custom-marker {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: 2px solid #ffffff;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .custom-marker:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        <div class="spinner"></div>
        Loading map...
    </div>

    <div id="map"></div>

    <div class="map-controls">
        <div class="control-group">
            <label class="control-label">Map Style</label>
            <select class="style-selector" id="styleSelector">
                <option value="dark">Dark Theme</option>
                <option value="satellite">Satellite</option>
            </select>
        </div>
        <div class="control-group">
            <label class="control-label">Coordinates</label>
            <div class="coordinates" id="coordinates">
                Lat: 39.8283, Lng: -98.5795
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    
    <!-- PostHog Analytics -->
    <script>
        !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]);var n=t;if("undefined"!=typeof e)for(var i=0;i<e.length;i++){var r=e[i];r in n||(n[r]={}),n=n[r]}return n}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onSessionId".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
        posthog.init('phc_YBQhOT7nxUyCAZKGdJkzI9C8T9WECcYoUxmFizT3LFs',{
            api_host:'https://us.i.posthog.com',
            person_profiles: 'identified_only'
        })
    </script>
    
    <script>
        // Initialize map centered on USA
        const map = L.map('map', {
            center: [39.8283, -98.5795],
            zoom: 4,
            zoomControl: true,
            attributionControl: true
        });

        // Dark tile layer options
        const tileLayers = {
            dark: L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                subdomains: 'abcd',
                maxZoom: 19
            }),
            satellite: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
            })
        };

        // Set initial tile layer
        let currentLayer = tileLayers.dark;
        currentLayer.addTo(map);

        // Live stream locations with YouTube embed links
        const locations = [
            { coords: [34.2438963,-116.9114215], name: "Big Bear Bald Eagle Live Nest - Cam 1", videoId: "B4-L2nfGcuE", description: "Big Bear Valley in the San Bernardino Mountains of Southern California" },            { coords: [35.7143, -83.5102], name: "Gatlinburg TN", videoId: "6Jth3YIN7ko", description: "Beautiful mountain town in Tennessee" },
            { coords: [36.1627, -86.7816], name: "Nashville TN - Downtown", videoId: "Gw0FXKfyBno", description: "Music City's bustling downtown" },
            { coords: [38.3269, -75.0927], name: "Ocean City MD - Inlet Beach", videoId: "pK_06XTUz3g", description: "Popular beach destination on the Atlantic" },
            { coords: [30.3935, -86.4958], name: "Destin FL - Pelican Beach", videoId: "sS4GzzSOY8Q", description: "Beautiful white sand beaches of Florida" },
            { coords: [28.1761, -80.5897], name: "Satellite Beach FL", videoId: "D4B4MdxLkQo", description: "Coastal Florida beach community" },
            { coords: [29.9584, -90.0644], name: "New Orleans LA", videoId: "qHW8srS0ylo", description: "The vibrant heart of Louisiana" },
            { coords: [34.0522, -118.2437], name: "Los Angeles CA", videoId: "PnpcdnZhztI", description: "City of Angels live stream" },
            { coords: [19.4069, -155.2834], name: "Kilauea HI", videoId: "sTXKIz2NGvg", description: "Active volcano in Hawaii" },
            { coords: [33.8621, -118.3998], name: "Hermosa Beach CA", videoId: "yJgfAV8lXyI", description: "Famous California beach destination" },
            { coords: [38.0194342,-84.5215242], name: "Lexington, KY Train Crossing", videoId: "Y3pgoDyuW38", description: "Berkshire Trains Live Stream at 83.2 Rosemont crossing in Lexington KY" },
            { coords: [28.5652787,-81.58618469999999], name: "Winter Garden, FL", videoId: "mvNnXQKN3ZU", description: "Winter Garden, FL" },
            { coords: [29.3012309,-94.7950151], name: "MURDOCHS CAM: Live from the Galveston Seawall", videoId: "aZ0tx7eeLYU", description: "The Galveston.com Murdoch" },
            { coords: [39.9934039,-75.1179823], name: "Kensington Philadelphia. Cam 7", videoId: "9z-qXarfpmA", description: "Kensington Philadelphia. " },
            { coords: [24.5465114,-81.7975065], name: "Key West Southernmost Point Live Cam", videoId: "r6H2RnNDC3k", description: "Key West southernmost poi" },
            { coords: [-24.2888714,15.2604813], name: "Namibia: Live stream in the Namib Desert", videoId: "ydYDqZQpim8", description: "Live feed, from a waterho" },
            { coords: [26.0110262,-80.1157583], name: "Live Beach Cam Hollywood Beach Broadwalk, Florida", videoId: "cmkAbDUEoyA", description: "Live views of the Hollywo" },
            { coords: [26.3184123,-80.09976569999999], name: "LIVE Deerfield Beach - Beach Camera", videoId: "-HAi_5IIAYg", description: "Welcome to the Deerfield " },
            { coords: [26.3184123,-80.09976569999999], name: "Underwater Camera - Deerfield Beach, Florida", videoId: "V7c7pBbH150", description: "Welcome to the Underwater" },
            { coords: [26.2305913,-80.12510209999999], name: "Pompano Beach Underwater Pier Cam", videoId: "hFr5w9KLEA4", description: "WELCOME! Dive into the de" },
            { coords: [18.3304513,-64.792952], name: "Beach Bar St. John Webcam", videoId: "2wqpy036z24", description: "The World Famous Beach Ba" },
            { coords: [40.9432955,-72.1936235], name: "Hamptons.com - LIVE! Coopers Beach, Southampton Village, New York - Rated #2 Beach In the Country !", videoId: "4cDBr4IZznY", description: "_____ Main Beach Cam, Eas" },
            { coords: [41.7281482,-86.9040495], name: "Access LaPorte County BeachCam", videoId: "Y2VkN45kj_0", description: "A live look at the Washin" },
            { coords: [40.8377066,-72.4965823], name: "Hamptons.com - LIVE SURF CAM! Ponquogue Beach Pavilion, Hampton Bays, New York", videoId: "DCG_-9UG3cI", description: "___---Hamptons.com - LIVE" },
            { coords: [12.16957,-68.99002], name: "LionsDive Beach Resort | Mambo Beach | Curaçao 🌴💦 PTZ 4K LIVE CAM", videoId: "loHbMM9JfCs", description: "Your Next Luxury Vacation" },
            { coords: [26.1296352,-80.1035553], name: "LIVE - Fort Lauderdale Beach", videoId: "8vTmL-oD3Lo", description: "One of PTZtv's two Fort L" },
            { coords: [30.383819,-86.49923179999999], name: "Inlet Reef Beachcam Destin, FL", videoId: "XGfKO7hW274", description: "Inlet Reef Beachcam Desti" },
            { coords: [35.7595731,-79.01929969999999], name: "Shark Cam powered by EXPLORE.org", videoId: "og8bbxl0iW8", description: "What marine life is found" },
            { coords: [30.2932415,-81.38929499999999], name: "Live Cam From The Best Western In Jacksonville Beach, Fl.", videoId: "bZ4uxyLqV-E", description: "NOTE: Times shown may not" },
            { coords: [26.0582958,-80.1110075], name: "Dania Beach Pier Cam", videoId: "o1eTLR7Degs", description: "Dania Beach Pier Cam" },
            { coords: [35.5584932,-75.4665158], name: "Outer Banks, NC. Blue Beach", videoId: "ZGXUi-5aJXM", description: "Outer Banks, NC. Blue Bea" },
            { coords: [25.7745435,-80.1708802], name: "🔴 LIVE Port Miami Cruise Ship Departures and Arrivals | ICON of the Seas", videoId: "os3QxtU_ZrQ", description: "iconoftheseas #cruiseship" },
            { coords: [25.7338942,-80.1652648], name: "Miami Acquarium", videoId: "7i8ARjIeM2k", description: "Miami Acquarium" },
            { coords: [25.7923496,-80.28230590000001], name: "LIVE Miami Airport -- Watch runway 9/27 with tower radio traffic!", videoId: "OXeFcz3lEz4", description: "Live streaming video from" },
            { coords: [26.1109199,-80.11226649999999], name: "New River Live Feed", videoId: "4YFHDjig1hc", description: "Thank you for enjoying ou" },
            { coords: [25.7745435,-80.1708802], name: "🔴 LIVE Port Miami Cruise Ship Terminals", videoId: "YvnIEm36tN8", description: "See live cruise ship arri" },
            { coords: [24.882662,-80.690772], name: "Tarpon Feeding Dock at Robbie's Marina in Islamorada - LIVE", videoId: "zfSst64NFcE", description: "Tarpon Feeding Dock at Ro" },
            { coords: [24.5550593,-81.7799871], name: "🔴 LIVE Cruise Port Key West", videoId: "8Rw-tZTeBjU", description: "Watch the cruise ships, N" },
            { coords: [18.0400527,-63.1208828], name: "World famous Plane Beach ✈️ -  Maho Beach Sint Maarten SXM", videoId: "LtzkkAeW_Qg", description: "World famous Plane Beach " },
            { coords: [53.3449379,-6.267473100000001], name: "EarthCam Live: Dublin, Ireland", videoId: "u4UZ4UvZXrg", description: "EarthCam is taking viewer" },
            { coords: [28.0186323,-82.1128641], name: "Plant City, Florida, USA |  - Virtual Railfan  LIVE !", videoId: "hMDC4FWvqdA", description: "Plant City, Florida, USA " },
            { coords: [29.5446753,-95.0910413], name: "City of Nassau bay", videoId: "WspqsK3bXAY", description: "City of Nassau bay" },
            { coords: [45.0229456,-85.76097229999999], name: "The Cove Leland Fishtown Live", videoId: "s7sY1waeOf4", description: "The Cove Leland Fishtown " },
            { coords: [12.16957,-68.99002], name: "The Royal Sea Aquarium Resort | Curacao 🌴☀️ LIVE CAM 4K", videoId: "IAkRcsPDO8w", description: "Live camera of The Royal " },
            { coords: [11.9846527,-68.6442344], name: "Klein Curaçao | Mermaid Boat Trips 🌴💦☀️ LIVE CAM", videoId: "0ImA9IcyQwA", description: "paradise" }
        ];

        // Add markers to map with video functionality
        locations.forEach((location, index) => {
            const customIcon = L.divIcon({
                className: 'custom-marker',
                html: `✳️`,
                iconSize: [25, 25],
                iconAnchor: [12, 12]
            });

            const marker = L.marker(location.coords, { icon: customIcon }).addTo(map);
            
            const popupContent = `
                <div style="color: #ffffff; background: #2d3748; padding: 15px; border-radius: 8px; width: 320px;">
                    <h3 style="margin: 0 0 10px 0; color: #63b3ed; font-size: 16px;">${location.name}</h3>
                    <p style="margin: 0 0 15px 0; font-size: 13px; color: #e2e8f0;">${location.description}</p>
                    <div style="position: relative; width: 100%; height: 180px; margin-bottom: 10px;">
                        <iframe 
                            width="100%" 
                            height="100%" 
                            src="https://www.youtube.com/embed/${location.videoId}?autoplay=1&mute=1&controls=1" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen
                            style="border-radius: 6px;">
                        </iframe>
                    </div>
                    <div style="font-size: 11px; color: #a0aec0;">
                        📍 ${location.coords[0].toFixed(4)}, ${location.coords[1].toFixed(4)}
                    </div>
                </div>
            `;
            
            marker.bindPopup(popupContent, {
                maxWidth: 350,
                className: 'video-popup'
            });

            // Track marker clicks with PostHog
            marker.on('click', function() {
                posthog.capture('marker_clicked', {
                    location_name: location.name,
                    coordinates: location.coords,
                    video_id: location.videoId,
                    description: location.description
                });
            });

            // Track popup opens
            marker.on('popupopen', function() {
                posthog.capture('video_popup_opened', {
                    location_name: location.name,
                    coordinates: location.coords,
                    video_id: location.videoId
                });
            });
        });

        // Update coordinates display
        function updateCoordinates(lat, lng) {
            document.getElementById('coordinates').textContent = 
                `Lat: ${lat.toFixed(4)}, Lng: ${lng.toFixed(4)}`;
        }

        // Mouse move event to update coordinates
        map.on('mousemove', function(e) {
            updateCoordinates(e.latlng.lat, e.latlng.lng);
        });

        // Style selector functionality
        document.getElementById('styleSelector').addEventListener('change', function(e) {
            const selectedStyle = e.target.value;
            
            // Track map style changes with PostHog
            posthog.capture('map_style_changed', {
                previous_style: currentLayer === tileLayers.dark ? 'dark' : 'satellite',
                new_style: selectedStyle
            });
            
            // Remove current layer
            map.removeLayer(currentLayer);
            
            // Add new layer
            currentLayer = tileLayers[selectedStyle];
            currentLayer.addTo(map);
        });

        // Hide loading indicator once map is loaded
        map.whenReady(function() {
            document.getElementById('loading').style.display = 'none';
            
            // Track page view and map loaded event
            posthog.capture('page_view', {
                page: 'live_camera_map',
                total_locations: locations.length
            });
            
            posthog.capture('map_loaded', {
                initial_zoom: map.getZoom(),
                initial_center: map.getCenter(),
                total_markers: locations.length
            });
        });

        // Track map movements
        map.on('moveend', function() {
            posthog.capture('map_moved', {
                center: map.getCenter(),
                zoom: map.getZoom(),
                bounds: map.getBounds()
            });
        });

        // Track zoom changes
        map.on('zoomend', function() {
            posthog.capture('map_zoomed', {
                zoom_level: map.getZoom(),
                center: map.getCenter()
            });
        });

        // Smooth zoom controls
        map.on('zoomstart', function() {
            map.getContainer().style.cursor = 'wait';
        });

        map.on('zoomend', function() {
            map.getContainer().style.cursor = '';
        });
    </script>
</body>
</html>
